
{% extends "base.html" %}
{% load static %}
    {% block content %}
<!--begin::Head-->
<!--end::Head-->
<!--begin::Body-->
<body id="kt_body" class="header-fixed header-mobile-fixed subheader-enabled subheader-fixed aside-enabled aside-fixed aside-minimize-hoverable page-loading">
    <!--begin::Main-->
    <!--begin::Header Mobile-->
    {% include "parts/header-mobile.html" %}
    <!--end::Header Mobile-->
    <div class="d-flex flex-column flex-root">
        <!--begin::Page-->
        <div class="d-flex flex-row flex-column-fluid page">
            <!--begin::Aside-->
            {% include "parts/aside.html" %}
            <!--end::Aside-->
            <!--begin::Wrapper-->
            <div class="d-flex flex-column flex-row-fluid wrapper" id="kt_wrapper">
                <!--begin::Header-->
                {% include "parts/header.html" %}
                <!--end::Header-->
                <!--begin::Content-->
                <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
                    <div class="d-flex flex-column-fluid">
                        <div class="container">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kassa Tizimi - Materialni Buxgalteriya</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 1400px;
            border-radius: 10px;
        }


        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            padding: 30px;
            min-height: 80vh;
        }

        .left-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .balance-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .balance-card {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);

            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            transition: left 0.5s;
        }

        .balance-card:hover::before {
            left: 100%;
        }

        .balance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .balance-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .balance-card h3 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .transaction-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            flex: 1;
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .transaction-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 15px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .transaction-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .transaction-item.income {
            border-left-color: #27ae60;
        }

        .transaction-item.expense {
            border-left-color: #e74c3c;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .transaction-info small {
            color: #7f8c8d;
        }

        .transaction-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .transaction-amount.income {
            color: #27ae60;
        }

        .transaction-amount.expense {
            color: #e74c3c;
        }

        .right-panel {
            
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(149, 165, 166, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }

            .balance-cards {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .right-panel {
                position: static;
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .notification.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
    <div class="container">

        <div class="card-header">
                                    <div class="card-title">
                                        <h3 class="card-label">
<i class="fas fa-cash-register"></i>
                                          Kirim chiqimlar 

                                        </h3>
                                    </div>
                                </div>
        <div class="main-content" style="background-color:white;">
            <div class="left-section">
                <div class="balance-cards">
                    <div class="balance-card">
                        <i class="fas fa-wallet"></i>
                        <h3>Umumiy Balans</h3>
                        <div class="balance-amount" >{{total_cash}} so'm</div>
                    </div>
                    <div class="balance-card">
                        <i class="fas fa-arrow-up"></i>
                        <h3>Kunlik Kirim</h3>
                        <div class="balance-amount" id="dailyIncome">{{daily_income}} so'm</div>
                    </div>
                    <div class="balance-card">
                        <i class="fas fa-arrow-down"></i>
                        <h3>Kunlik Chiqim</h3>
                        <div class="balance-amount" id="dailyExpense">{{daily_expense}} so'm</div>
                    </div>
                </div>

                <div class="transaction-section">
    <h2 class="section-title">
        <i class="fas fa-history"></i>
        Tranzaksiyalar Tarixi
    </h2>

    <div class="transaction-list">
        {% if transactions %}
            {% for transaction in transactions %}
                <div class="transaction-item {{ transaction.flow_type }}">
                    <div class="transaction-info">
                        <h4>{{ transaction.category.title }}</h4>
                        <small>{{ transaction.created_at|date:"d/m/Y H:i" }}</small>
                        {% if transaction.description %}
                            <p style="margin-top: 5px; font-size: 0.9em; color: #666;">
                                {{ transaction.description }}
                            </p>
                        {% endif %}
                    </div>
                    <div class="transaction-amount {{ transaction.flow_type }}">
                        {% if transaction.flow_type == 'income' %}
                            +{{ transaction.amount }} so'm
                        {% else %}
                            -{{ transaction.amount }} so'm
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>Hali hech qanday tranzaksiya mavjud emas</p>
            </div>
        {% endif %}
    </div>
</div>

            </div>

            <div class="right-panel">
                <h2 class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    Yangi Tranzaksiya
                </h2>

                <form class="form" method="post"">
                                        {% csrf_token %}
                                        {% for field in form %}

                                        <div class="form-group row">
                                            <label class="col-form-label text-right col-lg-3 col-sm-12" for="{{field.auto_id}}">
                                                {% if field.field.required %}
                                                <b>{{field.label}}</b>
                                                {% else %}
                                                {{field.label}} 
                                                {% endif %}
                                            </label>
                                            <div class='col-lg-9 col-md-9 col-sm-12'>
                                                <span style="color:red;">{{field.errors}}</span>
                                                {{field}}
                                            </div>
                                        </div>
                                        {% endfor %}    
                    <button type="submit" class="btn btn-primary" name="saved">
                        <i class="fas fa-save"></i> Saqlash
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">
                        <i class="fas fa-undo"></i> Tozalash
                    </button>
                </form>

                
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    
                        </div>
                        <!-- .container -->
                    </div> <!-- .d-flex.flex-column-fluid -->
                </div>
                <!--end::Content--> <!--begin::Footer-->
                {% include "parts/footer.html" %}
                <!--end::Footer-->
            </div>
            <!--end::Wrapper-->
        </div>
        <!--end::Page-->
    </div>
    <!--end::Main-->
    <!-- begin::User Panel-->
    {% include "parts/user-panel.html" %}
    <!--begin::Quick Cart-->
    <!--end::Quick Cart-->
    <!--begin::Quick Panel-->
    <!--end::Quick Panel-->
    <!--begin::Chat Panel-->
    <!--end::Chat Panel-->
    <!--begin::Scrolltop-->
    {% include "parts/scrolltop.html" %}
    <!--end::Scrolltop-->
    <!--begin::Sticky Toolbar-->
    <!--end::Sticky Toolbar-->
    <!--begin::Demo Panel-->
    <!--end::Demo Panel-->

        <script>
        // Ma'lumotlar ombori
        let transactions = [];
        let totalBalance = 0;

        // Kategoriyalar
        const categories = {
            income: [
                'Mahsulot Sotish',
                'Xizmat Ko\'rsatish',
                'Qarz Qaytarish',
                'Investitsiya',
                'Boshqa Kirim'
            ],
            expense: [
                'Material Xarid',
                'Ish Haqi',
                'Kommunal To\'lovlar',
                'Transport',
                'Ofis Xarajatlari',
                'Boshqa Chiqim'
            ]
        };

        // Sahifa yuklanganda
        document.addEventListener('DOMContentLoaded', function() {
            // Hozirgi sanani o'rnatish
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('date').value = now.toISOString().slice(0, 16);

            // Tranzaksiya turini o'zgartirishda kategoriyalarni yangilash
            document.getElementById('type').addEventListener('change', updateCategories);

            // Forma yuborishni boshqarish
            document.getElementById('transactionForm').addEventListener('submit', handleSubmit);

            // Dastlabki ma'lumotlarni yuklash
            updateDisplay();
        });

        function updateCategories() {
            const type = document.getElementById('type').value;
            const categorySelect = document.getElementById('category');
            
            categorySelect.innerHTML = '<option value="">Tanlang...</option>';
            
            if (type && categories[type]) {
                categories[type].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
            }
        }

        function handleSubmit(e) {
            e.preventDefault();
            
            const type = document.getElementById('type').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;
            const date = new Date(document.getElementById('date').value);

            if (!type || !amount || !category || !date) {
                showNotification('Iltimos, barcha majburiy maydonlarni to\'ldiring!', 'error');
                return;
            }

            const transaction = {
                id: Date.now(),
                type: type,
                amount: amount,
                category: category,
                description: description,
                date: date,
                timestamp: new Date()
            };

            transactions.unshift(transaction);
            
            if (type === 'income') {
                totalBalance += amount;
            } else {
                totalBalance -= amount;
            }

            updateDisplay();
            clearForm();
            showNotification('Tranzaksiya muvaffaqiyatli saqlandi!', 'success');
        }

        function clearForm() {
            document.getElementById('transactionForm').reset();
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('date').value = now.toISOString().slice(0, 16);
            document.getElementById('category').innerHTML = '<option value="">Tanlang...</option>';
        }

        function updateDisplay() {
            updateBalanceCards();
            updateTransactionList();
        }

        function updateBalanceCards() {
            document.getElementById('totalBalance').textContent = formatCurrency(totalBalance);
            
            const today = new Date().toDateString();
            const todayTransactions = transactions.filter(t => t.date.toDateString() === today);
            
            const dailyIncome = todayTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const dailyExpense = todayTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            document.getElementById('dailyIncome').textContent = formatCurrency(dailyIncome);
            document.getElementById('dailyExpense').textContent = formatCurrency(dailyExpense);
        }

        function updateTransactionList() {
            const listContainer = document.getElementById('transactionList');
            
            if (transactions.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>Hali hech qanday tranzaksiya mavjud emas</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = transactions.map(transaction => `
                <div class="transaction-item ${transaction.type}">
                    <div class="transaction-info">
                        <h4>${transaction.category}</h4>
                        <small>${formatDate(transaction.date)}</small>
                        ${transaction.description ? `<p style="margin-top: 5px; font-size: 0.9em; color: #666;">${transaction.description}</p>` : ''}
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
                    </div>
                </div>
            `).join('');
        }

        function formatDate(date) {
            return date.toLocaleDateString('uz-UZ', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => notification.classList.remove('show'), 3000);
        }
    </script>

</body>
<!--end::Body-->
{% endblock %}

